!function(a){jq_jQuery.fn.snapPuzzle=function(a){function c(a){var c="sp_"+(new Date).getTime(),e=a.wrap('<span class="snappuzzle-wrap"/>').closest("span"),f=a.attr("src"),g=a.width()/b.columns,h=a.height()/b.rows,i=jq_jQuery(b.pile).addClass("snappuzzle-pile"),j=i.width()-g,k=i.height()-h,l=[];b.puzzle_class=c,a.data("options",b),num=1;for(var m=0;m<b.rows;m++)for(var n=0;n<b.columns;n++)l.push([m,n,num]),num++;l=d(l),l.forEach(function(d){var l=d[0],m=d[1],n=d[2];jq_jQuery('<div class="snappuzzle-piece '+c+'" data-number="'+(42*n).toString(36)+'"/>').data("pos",l+"_"+m).css({width:g,height:h,position:"absolute",left:Math.floor(Math.random()*(j+1)),top:Math.floor(Math.random()*(k+1)),zIndex:Math.floor(10*Math.random()+1),backgroundImage:"url("+f+")",backgroundPosition:-m*g+"px "+-l*h+"px",backgroundSize:a.width()}).draggable({start:function(c,d){jq_jQuery(this).removeData("slot"),b.onDraggable(a)},stack:".snappuzzle-piece",containment:b.containment}).appendTo(i).data("lastSlot",i),jq_jQuery('<div class="snappuzzle-slot '+c+'"/>').data("pos",l+"_"+m).css({width:g,height:h,left:m*g,top:l*h}).appendTo(e).droppable({accept:"."+c,hoverClass:"snappuzzle-slot-hover",drop:function(d,e){var f=jq_jQuery(this).data("pos");return jq_jQuery(".snappuzzle-piece."+c).each(function(){jq_jQuery(this).data("slot")==f&&(f=!1)}),!!f&&(e.draggable.data("lastSlot",jq_jQuery(this)).data("slot",f),e.draggable.position({of:jq_jQuery(this),my:"left top",at:"left top"}),void(e.draggable.data("pos")==f&&(e.draggable.addClass("correct"),b.onCorrect(e.draggable),jq_jQuery(this).droppable("disable").css("opacity",1),e.draggable.css({opacity:0,cursor:"default"}).draggable("disable"),jq_jQuery(".snappuzzle-piece.correct."+c).length==b.rows*b.columns&&b.onComplete(a))))}})})}function d(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}var b=jq_jQuery.extend({pile:"",containment:"document",rows:5,columns:5,onComplete:function(){},onCorrect:function(a){},onDraggable:function(){}},a);return"string"==typeof a?(this.each(function(){var b=jq_jQuery(this),c=b.data("options"),d=b.width()/c.columns,e=b.height()/c.rows,f=jq_jQuery(c.pile),g=f.width()-d,h=f.height()-e,i=b.closest("span").offset(),j=f.offset();"destroy"==a?(jq_jQuery("."+c.puzzle_class).remove(),b.unwrap().removeData("options"),f.removeClass("snappuzzle-pile")):"refresh"==a&&(jq_jQuery(".snappuzzle-slot."+c.puzzle_class).each(function(){var a=jq_jQuery(this).data("pos").split("_"),b=a[0],c=a[1];jq_jQuery(this).css({width:d,height:e,left:c*d,top:b*e})}),jq_jQuery(".snappuzzle-piece."+c.puzzle_class).each(function(){if(jq_jQuery(this).data("slot")){var a=jq_jQuery(this).data("slot").split("_"),c=a[0],f=a[1],a=jq_jQuery(this).data("pos").split("_"),k=a[0],l=a[1];jq_jQuery(this).css({width:d,height:e,left:f*d+i.left-j.left,top:c*e+i.top-j.top,backgroundPosition:-l*d+"px "+-k*e+"px",backgroundSize:b.width()})}else{var a=jq_jQuery(this).data("pos").split("_"),m=a[0],n=a[1];jq_jQuery(this).css({width:d,height:e,left:Math.floor(Math.random()*(g+1)),top:Math.floor(Math.random()*(h+1)),backgroundPosition:-n*d+"px "+-m*e+"px",backgroundSize:b.width()})}}))}),this):this.each(function(){this.complete?c(jq_jQuery(this)):jq_jQuery(this).load(function(){c(jq_jQuery(this))})})}}(jQuery);